type School @model @auth(rules: [
  { allow: public, provider: apiKey, operations: [read] },
  { allow: private, provider: iam }
]) {
  id: ID!
  name: String!
  address: String
  students: [Student] @hasMany
  teachers: [Teacher] @hasMany(indexName: "bySchool", fields: ["id"])
  classes: [Class] @hasMany(indexName: "bySchool", fields: ["id"])
}

type Parent @model @auth(rules: [
  { allow: owner },
  { allow: private, operations: [read] },
  { allow: public, provider: apiKey }
]) {
  id: ID!
  cognitoUserId: String @index(name: "byCognitoUser")
  firstName: String!
  lastName: String!
  phoneNumber: String
  canEditRecords: Boolean
  students: [Student] @manyToMany(relationName: "ParentStudents")
}

type Student @model @auth(rules: [
  { allow: private, operations: [read] },
  { allow: groups, groups: ["Teachers"], operations: [read, update] },
  { allow: public, provider: apiKey }
]) {
  id: ID!
  firstName: String!
  lastName: String!
  dateOfBirth: AWSDate
  gradeLevel: Int
  attendanceRate: Float
  currentStatus: String
  school: School @belongsTo
  parents: [Parent] @manyToMany(relationName: "ParentStudents")
  enrollments: [Enrollment] @hasMany(indexName: "byStudent", fields: ["id"])
}

type Teacher @model @auth(rules: [{ allow: public }]) {
  id: ID!
  name: String!
  cognitoUserId: String @index(name: "byCognitoUser")
  schoolId: ID! @index(name: "bySchool")
  school: School @belongsTo(fields: ["schoolId"])
  classes: [Class] @hasMany(indexName: "byTeacher", fields: ["id"])
}

type Class @model @auth(rules: [{ allow: public }]) {
  id: ID!
  name: String!
  teacherId: ID! @index(name: "byTeacher")
  schoolId: ID! @index(name: "bySchool")
  teacher: Teacher @belongsTo(fields: ["teacherId"])
  school: School @belongsTo(fields: ["schoolId"])
  enrollments: [Enrollment] @hasMany(indexName: "byClass", fields: ["id"])
}

type Enrollment @model @auth(rules: [{ allow: public }]) {
  id: ID!
  studentId: ID! @index(name: "byStudent")
  classId: ID! @index(name: "byClass")
  currentGrade: Float
  student: Student @belongsTo(fields: ["studentId"])
  class: Class @belongsTo(fields: ["classId"])
}
type Attendance @model @auth(rules: [{ allow: public }]) {
  id: ID!
  studentId: ID! @index(name: "byStudent")
  classId: ID! @index(name: "byClass")
  date: AWSDate!
  status: AttendanceStatus!
  student: Student @belongsTo(fields: ["studentId"])
  class: Class @belongsTo(fields: ["classId"])
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
}
type Announcement @model @auth(rules: [{ allow: public }]) {
  id: ID!
  title: String!
  body: String!
  createdAt: AWSDateTime!
  createdBy: ID!
  schoolId: ID @index(name: "bySchool")
  classId: ID @index(name: "byClass")
}
